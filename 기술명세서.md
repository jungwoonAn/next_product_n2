# n2 프로젝트 기술 명세서

## 1. 프로젝트 개요

본 문서는 Next.js 기반의 상품 관리 애플리케이션 'n2'의 기술적 사양과 구조를 설명합니다. 이 애플리케이션은 상품 카탈로그 조회, 상품 상세 정보 확인, 신규 상품 등록 기능을 제공합니다.

---

## 2. 핵심 기술 스택

- **프레임워크**: Next.js (v16.0.8), React (v19.2.1)
- **스타일링**: Tailwind CSS
- **언어**: JavaScript (ES6+)
- **패키지 매니저**: npm

---

## 3. 아키텍처 및 렌더링 전략

- **앱 라우터 (App Router)**: Next.js 13+의 앱 라우터 모델을 사용하여 파일 시스템 기반 라우팅을 구현합니다.
- **컴포넌트 모델**:
  - **서버 컴포넌트 (RSC)**: 데이터 페칭 및 서버 사이드 로직 처리를 위해 기본적으로 사용됩니다. (예: `app/product/catalog/[page]/page.jsx`)
  - **클라이언트 컴포넌트**: 사용자 상호작용 및 상태 관리가 필요한 경우 `'use client'` 지시어를 사용하여 클라이언트에서 렌더링됩니다. (예: `components/product/productAddCP.jsx`)
- **데이터 관리**:
  - **데이터 페칭**: 서버 컴포넌트 내에서 `fetch` API를 사용하여 백엔드 API 서버(`http://localhost:8080`)로부터 데이터를 가져옵니다.
  - **데이터 변경**: React의 **서버 액션(Server Actions)** 을 사용하여 클라이언트의 폼(form) 데이터를 서버에서 직접 처리하고 데이터베이스를 업데이트합니다.
- **렌더링 전략**:
  - **정적 사이트 생성 (SSG)**: `generateStaticParams` 함수를 사용하여 빌드 시점에 특정 상품 및 카탈로그 페이지를 미리 생성합니다.
  - **점진적 정적 재생성 (ISR)**: `fetch` 함수의 `revalidate` 옵션을 사용하여 일정 시간(60초 또는 120초)이 지나면 캐시된 데이터를 백그라운드에서 갱신하여 최신 상태를 유지합니다.

---

## 4. 데이터 흐름

### 4.1. 상품 목록 조회 (Read)

1.  **사용자**: `/product/catalog/1` 경로로 접근합니다.
2.  **Next.js (서버)**: `app/product/catalog/[page]/page.jsx` 서버 컴포넌트가 렌더링됩니다.
3.  **데이터 페칭**: 컴포넌트 내의 `fetch`가 백엔드 API(`http://localhost:8080/api/products/list?page=1&size=4`)를 호출하여 상품 목록 데이터를 가져옵니다.
4.  **렌더링**: 가져온 데이터를 `ProductCatalogCP` 컴포넌트에 props로 전달하여 UI를 렌더링합니다. 페이지는 정적으로 제공되며, 60초마다 ISR을 통해 데이터가 갱신됩니다.

### 4.2. 신규 상품 등록 (Create)

1.  **사용자**: `/product/add` 페이지의 폼에 상품 정보를 입력하고 'Add Product' 버튼을 클릭합니다.
2.  **Next.js (클라이언트)**: `productAddCP.jsx` 컴포넌트는 `useActionState` 훅을 통해 `postProduct` 서버 액션을 호출합니다. 입력된 폼 데이터가 `FormData` 객체로 서버에 전달됩니다.
3.  **Next.js (서버)**: `actions/productActions.js`의 `postProduct` 함수가 실행됩니다.
4.  **API 호출**: 함수는 `FormData`를 가공하여 백엔드 API(`http://localhost:8080/api/products`)에 `POST` 요청을 보내 상품을 생성합니다.
5.  **캐시 무효화**: 상품 생성이 성공하면 `revalidatePath('/product/catalog/1')`를 호출하여 카탈로그 페이지의 캐시를 무효화합니다.
6.  **상태 업데이트**: 서버 액션의 반환 값(`{result: 'success'}`)이 클라이언트 컴포넌트의 `state`에 반영되어 "New Product Added" 메시지가 표시됩니다.

---

## 5. 주요 파일 및 컴포넌트 설명

- **`next.config.mjs`**: 이미지 최적화 비활성화, 외부 이미지 호스트(`localhost:8080`) 등록, 서버 액션의 body 크기 제한, `/product` 경로의 리다이렉트 등 Next.js의 핵심 동작을 설정합니다.
- **`app/product/catalog/[page]/page.jsx`**: 상품 카탈로그 페이지. 동적 페이지 번호를 받아 API로부터 상품 목록을 가져옵니다.
- **`components/product/productCatalogCP.jsx`**: 상품 목록을 받아 실제 UI를 그리는 컴포넌트. 각 상품을 클릭하면 상세 페이지로 이동합니다.
- **`app/product/view/[pno]/page.jsx`**: 상품 상세 페이지. 동적 상품 번호(pno)를 받아 해당 상품의 데이터를 API로부터 가져옵니다.
- **`components/product/productViewCP.jsx`**: 단일 상품 데이터를 받아 상세 정보와 이미지를 표시하는 컴포넌트.
- **`components/product/productAddCP.jsx`**: 상품 등록 폼을 포함한 클라이언트 컴포넌트. `useActionState` 훅을 사용하여 서버 액션과 통신하며 UI 상태를 관리합니다.
- **`actions/productActions.js`**: `'use server'` 지시어가 명시된 서버 액션 파일. `postProduct` 함수는 폼 데이터를 처리하여 백엔드 API로 전송하고 캐시를 갱신하는 역할을 수행합니다.

---

## 6. 개선 제안 사항

- **하드코딩된 값 제거**:
  - `components/product/productCatalogCP.jsx`의 이미지 경로에 하드코딩된 IP 주소(`192.168.10.50:8080`)를 환경 변수(`API_SERVER_HOST`)로 대체해야 합니다.
  - `generateStaticParams`에 하드코딩된 페이지/상품 번호를 API에서 동적으로 가져오도록 수정해야 합니다.
- **사용자 인증**: `productAddCP.jsx`에서 작성자(`writer`)가 'user1'로 하드코딩되어 있습니다. 실제 운영을 위해서는 사용자 인증 시스템을 도입하고, 현재 로그인된 사용자 정보를 사용해야 합니다.
